import{a as s}from"./chunk-FUHT4GF3.js";import{d as N,f as H}from"./chunk-NHWHVDAZ.js";import{Ab as i,Bb as g,Bc as U,Cb as S,Cc as z,Eb as u,Ec as T,Fc as f,Hc as b,Ic as _,Jc as y,Lb as c,Mb as m,Oa as o,Sa as I,Ya as P,a as w,ab as R,c as E,hb as v,hc as B,jc as W,kc as k,lb as a,mb as n,nb as A,rb as M,sb as O}from"./chunk-4NO66VA3.js";function J(p,e){p&1&&(a(0,"div",12),i(1,"\u8A08\u7B97\u4E2D\u30FB\u30FB\u30FB"),n())}function K(p,e){if(p&1&&(a(0,"div")(1,"div",13)(2,"span",14),i(3,"\u5065\u5EB7\u4FDD\u967A\uFF08\u5168\u984D\uFF09"),n(),a(4,"span",15),i(5),c(6,"number"),n()(),a(7,"div",13)(8,"span",14),i(9,"\u5065\u5EB7\u4FDD\u967A\uFF08\u4F1A\u793E\u8CA0\u62C5\uFF09"),n(),a(10,"span",15),i(11),c(12,"number"),n()(),a(13,"div",13)(14,"span",14),i(15,"\u5065\u5EB7\u4FDD\u967A\uFF08\u5F93\u696D\u54E1\u8CA0\u62C5\uFF09"),n(),a(16,"span",15),i(17),c(18,"number"),n()(),a(19,"div",13)(20,"span",14),i(21,"\u4ECB\u8B77\u4FDD\u967A\uFF08\u5168\u984D\uFF09"),n(),a(22,"span",15),i(23),c(24,"number"),n()(),a(25,"div",13)(26,"span",14),i(27,"\u4ECB\u8B77\u4FDD\u967A\uFF08\u4F1A\u793E\u8CA0\u62C5\uFF09"),n(),a(28,"span",15),i(29),c(30,"number"),n()(),a(31,"div",13)(32,"span",14),i(33,"\u4ECB\u8B77\u4FDD\u967A\uFF08\u5F93\u696D\u54E1\u8CA0\u62C5\uFF09"),n(),a(34,"span",15),i(35),c(36,"number"),n()(),a(37,"div",13)(38,"span",14),i(39,"\u539A\u751F\u5E74\u91D1\uFF08\u5168\u984D\uFF09"),n(),a(40,"span",15),i(41),c(42,"number"),n()(),a(43,"div",13)(44,"span",14),i(45,"\u539A\u751F\u5E74\u91D1\uFF08\u4F1A\u793E\u8CA0\u62C5\uFF09"),n(),a(46,"span",15),i(47),c(48,"number"),n()(),a(49,"div",13)(50,"span",14),i(51,"\u539A\u751F\u5E74\u91D1\uFF08\u5F93\u696D\u54E1\u8CA0\u62C5\uFF09"),n(),a(52,"span",15),i(53),c(54,"number"),n()(),a(55,"div",13)(56,"span",14),i(57,"\u5168\u984D\u5408\u8A08"),n(),a(58,"span",15),i(59),n()(),a(60,"div",13)(61,"span",14),i(62,"\u4F1A\u793E\u8CA0\u62C5\u5408\u8A08"),n(),a(63,"span",15),i(64),n()(),a(65,"div",13)(66,"span",14),i(67,"\u5F93\u696D\u54E1\u8CA0\u62C5\u5408\u8A08"),n(),a(68,"span",15),i(69),n()()()),p&2){let t=O();o(5),u("",t.standardsList.length>0?m(6,30,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.healthInsuranceRate100,"\uFF05\uFF1D",t.healthInsuranceAmount,"\u5186"),o(6),u("",t.standardsList.length>0?m(12,33,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.healthInsuranceRate100,"\uFF05\xF72\uFF1D",t.healthInsuranceAmountCompany,"\u5186"),o(6),u("",t.standardsList.length>0?m(18,36,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.healthInsuranceRate100,"\uFF05\xF72\uFF1D",t.healthInsuranceAmountEmployee,"\u5186"),o(6),u("",t.standardsList.length>0?m(24,39,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.careInsuranceRate100,"\uFF05\uFF1D",t.careInsuranceAmount,"\u5186"),o(6),u("",t.standardsList.length>0?m(30,42,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.careInsuranceRate100,"\uFF05\xF72\uFF1D",t.careInsuranceAmountCompany,"\u5186"),o(6),u("",t.standardsList.length>0?m(36,45,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.careInsuranceRate100,"\uFF05\xF72\uFF1D",t.careInsuranceAmountEmployee,"\u5186"),o(6),u("",t.standardsList.length>0?m(42,48,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].nenkinStandardMonthly,"1.0-0"):t.stdSalaryPensionWithComma,"\u5186\xD7",t.pensionInsuranceRate100,"\uFF05\uFF1D",t.pensionInsuranceAmount,"\u5186"),o(6),u("",t.standardsList.length>0?m(48,51,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].nenkinStandardMonthly,"1.0-0"):t.stdSalaryPensionWithComma,"\u5186\xD7",t.pensionInsuranceRate100,"\uFF05\xF72\uFF1D",t.pensionInsuranceAmountCompany,"\u5186"),o(6),u("",t.standardsList.length>0?m(54,54,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].nenkinStandardMonthly,"1.0-0"):t.stdSalaryPensionWithComma,"\u5186\xD7",t.pensionInsuranceRate100,"\uFF05\xF72\uFF1D",t.pensionInsuranceAmountEmployee,"\u5186"),o(6),S("",t.totalInsuranceAmount,"\u5186"),o(5),S("",t.totalInsuranceAmountCompany,"\u5186"),o(5),S("",t.totalInsuranceAmountEmployee,"\u5186")}}var j=class p{constructor(e,t,r){this.route=e;this.firestore=t;this.router=r}employeesId="";companyId="";employeeData=null;companyData=null;officeData=null;insuranceRateData=null;currentNendo=(()=>{let e=new Date,t=e.getFullYear();return e.getMonth()+1>=4?t:t-1})();standardsList=[];isLoading=!0;ngOnInit(){return E(this,null,function*(){this.isLoading=!0,this.employeesId=this.route.snapshot.paramMap.get("id")||"";let e=f(this.firestore,"companies"),t=yield y(e);for(let r of t.docs){let h=f(this.firestore,"companies",r.id,"employees"),F=yield y(h);for(let D of F.docs)if(D.id===this.employeesId){this.companyId=r.id,this.employeeData=D.data();let l=b(this.firestore,"companies",this.companyId),d=yield _(l);if(this.companyData=d.exists()?d.data():null,this.employeeData.officesId){let C=b(this.firestore,"companies",this.companyId,"offices",this.employeeData.officesId),L=yield _(C);if(this.officeData=L.exists()?L.data():null,this.officeData&&this.officeData.officePrefecture){let q=f(this.firestore,"insurance_rates"),G=yield y(q);this.insuranceRateData=G.docs.map(x=>x.data()).find(x=>x.prefecture===this.officeData.officePrefecture&&String(x.year)===String(this.currentNendo))||null}}let $=f(this.firestore,`companies/${this.companyId}/employees/${this.employeesId}/standards`),Y=yield y($);this.standardsList=Y.docs.map(C=>w({id:C.id},C.data())),this.isLoading=!1;return}}console.log("currentNendo:",this.currentNendo),this.isLoading=!1})}get healthInsuranceRate100(){if(!this.insuranceRateData||this.insuranceRateData.health_insurance==null)return"";try{return new s(this.insuranceRateData.health_insurance).times(100).toString()}catch{return""}}get careInsuranceRate100(){if(!this.insuranceRateData||this.insuranceRateData.care_insurance==null)return"";try{return new s(this.insuranceRateData.care_insurance).times(100).toString()}catch{return""}}get pensionInsuranceRate100(){if(!this.insuranceRateData||this.insuranceRateData.pension_insurance==null)return"";try{return new s(this.insuranceRateData.pension_insurance).times(100).toString()}catch{return""}}formatWithComma(e){if(e==null||e==="")return"";let t=typeof e=="number"?e:Number(e);return isNaN(t)?"":t.toLocaleString()}get healthInsuranceAmount(){if(!this.insuranceRateData)return"";let e=this.standardsList.length>0?this.standardsList[this.standardsList.length-1].kenpoStandardMonthly:this.employeeData?this.employeeData.stdSalaryHealth:null,t=this.insuranceRateData.health_insurance;if(e==null||t==null)return"";try{return this.formatWithComma(new s(e).times(new s(t)).toDecimalPlaces(0,s.ROUND_HALF_UP).toString())}catch{return""}}get pensionInsuranceAmount(){if(!this.insuranceRateData)return"";let e=this.standardsList.length>0?this.standardsList[this.standardsList.length-1].nenkinStandardMonthly:this.employeeData?this.employeeData.stdSalaryPension:null,t=this.insuranceRateData.pension_insurance;if(e==null||t==null)return"";try{return this.formatWithComma(new s(e).times(new s(t)).toFixed(0))}catch{return""}}get healthInsuranceAmountCompany(){let e=this.healthInsuranceAmount.replace(/,/g,"");if(!e)return"";try{return this.formatWithComma(new s(e).div(2).toDecimalPlaces(0,s.ROUND_HALF_UP).toString())}catch{return""}}get healthInsuranceAmountEmployee(){let e=this.healthInsuranceAmount.replace(/,/g,"");if(!e)return"";try{let t=new s(e).div(2);return t.minus(t.floor()).times(10).toNumber()<=5?this.formatWithComma(t.floor().toString()):this.formatWithComma(t.ceil().toString())}catch{return""}}get pensionInsuranceAmountCompany(){let e=this.pensionInsuranceAmount.replace(/,/g,"");if(!e)return"";try{return this.formatWithComma(new s(e).div(2).toDecimalPlaces(0,s.ROUND_HALF_UP).toString())}catch{return""}}get pensionInsuranceAmountEmployee(){let e=this.pensionInsuranceAmount.replace(/,/g,"");if(!e)return"";try{let t=new s(e).div(2);return t.minus(t.floor()).times(10).toNumber()<=5?this.formatWithComma(t.floor().toString()):this.formatWithComma(t.ceil().toString())}catch{return""}}get careInsuranceAmount(){if(!this.insuranceRateData)return"";let e=this.standardsList.length>0?this.standardsList[this.standardsList.length-1].kenpoStandardMonthly:this.employeeData?this.employeeData.stdSalaryHealth:null,t=this.insuranceRateData.care_insurance;if(e==null||t==null)return"";try{return this.formatWithComma(new s(e).times(new s(t)).toDecimalPlaces(0,s.ROUND_HALF_UP).toString())}catch{return""}}get careInsuranceAmountCompany(){let e=this.careInsuranceAmount.replace(/,/g,"");if(!e)return"";try{return this.formatWithComma(new s(e).div(2).toDecimalPlaces(0,s.ROUND_HALF_UP).toString())}catch{return""}}get careInsuranceAmountEmployee(){let e=this.careInsuranceAmount.replace(/,/g,"");if(!e)return"";try{let t=new s(e).div(2);return t.minus(t.floor()).times(10).toNumber()<=5?this.formatWithComma(t.floor().toString()):this.formatWithComma(t.ceil().toString())}catch{return""}}get totalInsuranceAmount(){let e=this.healthInsuranceAmount.replace(/,/g,""),t=this.pensionInsuranceAmount.replace(/,/g,""),r=this.careInsuranceAmount.replace(/,/g,"");if(!e&&!t&&!r)return"";try{return this.formatWithComma(new s(e||0).plus(new s(t||0)).plus(new s(r||0)).toString())}catch{return""}}get totalInsuranceAmountCompany(){let e=this.healthInsuranceAmountCompany.replace(/,/g,""),t=this.pensionInsuranceAmountCompany.replace(/,/g,""),r=this.careInsuranceAmountCompany.replace(/,/g,"");if(!e&&!t&&!r)return"";try{return this.formatWithComma(new s(e||0).plus(new s(t||0)).plus(new s(r||0)).toString())}catch{return""}}get totalInsuranceAmountEmployee(){let e=this.healthInsuranceAmountEmployee.replace(/,/g,""),t=this.pensionInsuranceAmountEmployee.replace(/,/g,""),r=this.careInsuranceAmountEmployee.replace(/,/g,"");if(!e&&!t&&!r)return"";try{return this.formatWithComma(new s(e||0).plus(new s(t||0)).plus(new s(r||0)).toString())}catch{return""}}get stdSalaryHealthWithComma(){return!this.employeeData||this.employeeData.stdSalaryHealth==null?"":this.formatWithComma(this.employeeData.stdSalaryHealth)}get stdSalaryPensionWithComma(){return!this.employeeData||this.employeeData.stdSalaryPension==null?"":this.formatWithComma(this.employeeData.stdSalaryPension)}onSaveCalc=()=>E(this,null,function*(){if(!this.employeesId)return;let e=f(this.firestore,"companies",this.companyId,"employees",this.employeesId,"insurances"),t=yield y(e),r={},h=null;t.forEach(D=>{let l=D.data();(!h||l.createdAt&&l.createdAt.toMillis&&l.createdAt.toMillis()>h)&&(h=l.createdAt&&l.createdAt.toMillis?l.createdAt.toMillis():null,r=l)});let F={healthInsuranceTotal:this.healthInsuranceAmount.replace(/,/g,""),healthInsuranceCompany:this.healthInsuranceAmountCompany.replace(/,/g,""),healthInsuranceEmployee:this.healthInsuranceAmountEmployee.replace(/,/g,""),careInsuranceTotal:this.careInsuranceAmount.replace(/,/g,""),careInsuranceCompany:this.careInsuranceAmountCompany.replace(/,/g,""),careInsuranceEmployee:this.careInsuranceAmountEmployee.replace(/,/g,""),pensionInsuranceTotal:this.pensionInsuranceAmount.replace(/,/g,""),pensionInsuranceCompany:this.pensionInsuranceAmountCompany.replace(/,/g,""),pensionInsuranceEmployee:this.pensionInsuranceAmountEmployee.replace(/,/g,""),total:this.totalInsuranceAmount.replace(/,/g,""),totalCompany:this.totalInsuranceAmountCompany.replace(/,/g,""),totalEmployee:this.totalInsuranceAmountEmployee.replace(/,/g,""),employeeId:this.employeesId,createdAt:U()};Object.keys(r).length>0&&Object.keys(F).filter(d=>d!=="createdAt"&&d!=="createdBy").every(d=>String(F[d])===String(r[d]))||(yield T(e,F),this.router.navigate(["/employee-detail",this.employeesId]))});static \u0275fac=function(t){return new(t||p)(I(N),I(z),I(H))};static \u0275cmp=P({type:p,selectors:[["app-calculate"]],decls:46,vars:7,consts:[[1,"info-calc-flex"],[1,"office-info"],[1,"office-label"],[1,"office-value"],[1,"extra-info-box"],[1,"extra-info-row"],[1,"extra-info-label"],[1,"extra-info-value"],[1,"calculate-container"],["type","button",1,"save-calc-btn",3,"click"],["class","loading-message",4,"ngIf"],[4,"ngIf"],[1,"loading-message"],[1,"calc-row"],[1,"calc-label"],[1,"calc-value"]],template:function(t,r){t&1&&(a(0,"div",0)(1,"div")(2,"div",1)(3,"div")(4,"span",2),i(5,"\u6240\u5C5E\u4E8B\u696D\u6240\uFF1A"),n(),a(6,"span",3),i(7),n()(),a(8,"div")(9,"span",2),i(10,"\u6240\u5728\u90FD\u9053\u5E9C\u770C\uFF1A"),n(),a(11,"span",3),i(12),n()(),a(13,"div")(14,"span",2),i(15,"\u5065\u5EB7\u4FDD\u967A\u6599\u7387\uFF1A"),n(),a(16,"span",3),i(17),n()(),a(18,"div")(19,"span",2),i(20,"\u4ECB\u8B77\u4FDD\u967A\u6599\u7387\uFF1A"),n(),a(21,"span",3),i(22),n()(),a(23,"div")(24,"span",2),i(25,"\u539A\u751F\u5E74\u91D1\u4FDD\u967A\u6599\u7387\uFF1A"),n(),a(26,"span",3),i(27),n()()(),a(28,"div",4)(29,"div",5)(30,"span",6),i(31,"\u5065\u5EB7\u4FDD\u967A\u5BFE\u8C61\uFF1A"),n(),A(32,"span",7),n(),a(33,"div",5)(34,"span",6),i(35,"\u4ECB\u8B77\u4FDD\u967A\uFF1A"),n(),A(36,"span",7),n(),a(37,"div",5)(38,"span",6),i(39,"\u539A\u751F\u5E74\u91D1\u5BFE\u8C61\uFF1A"),n(),A(40,"span",7),n()()(),a(41,"div",8)(42,"button",9),M("click",function(){return r.onSaveCalc()}),i(43,"\u8A08\u7B97\u7D50\u679C\u3092\u4FDD\u5B58"),n(),R(44,J,2,0,"div",10)(45,K,70,57,"div",11),n()()),t&2&&(o(7),g((r.officeData==null?null:r.officeData.officeName)||"---"),o(5),g((r.officeData==null?null:r.officeData.officePrefecture)||"---"),o(5),g(r.insuranceRateData!=null&&r.insuranceRateData.health_insurance?r.insuranceRateData.health_insurance*100+"\uFF05":"---"),o(5),g(r.insuranceRateData!=null&&r.insuranceRateData.care_insurance?r.insuranceRateData.care_insurance*100+"\uFF05":"---"),o(5),g(r.insuranceRateData!=null&&r.insuranceRateData.pension_insurance?r.insuranceRateData.pension_insurance*100+"\uFF05":"---"),o(17),v("ngIf",r.isLoading),o(),v("ngIf",!r.isLoading&&r.employeeData))},dependencies:[k,B,W],styles:[".calculate-container[_ngcontent-%COMP%]{padding-top:4rem;max-width:600px;margin:0 auto;background:#f8fafc;border-radius:12px;box-shadow:0 2px 12px #1976d212;padding-bottom:2.5rem}.calculate-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:1.2rem}.calculate-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:1.04rem;color:#222;padding:.32rem .2rem;border-bottom:1px solid #e3e8ee}.calculate-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child{border-bottom:none}.calculate-container[_ngcontent-%COMP%]   .loading-message[_ngcontent-%COMP%]{text-align:center;font-size:1.08rem;color:#1976d2;padding:2.5rem 0;font-weight:600}.save-calc-btn[_ngcontent-%COMP%]{display:block;margin:.1rem auto;background:#1976d2;color:#fff;font-size:.95rem;font-weight:600;padding:.4rem 1.2rem;border:none;border-radius:7px;cursor:pointer;box-shadow:0 1px 4px #1976d214;transition:background .2s}.save-calc-btn[_ngcontent-%COMP%]:hover{background:#1565c0}@media (max-width: 600px){.calculate-container[_ngcontent-%COMP%]{padding:1.2rem .5rem 2rem;max-width:99vw}.calculate-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:.98rem}.save-calc-btn[_ngcontent-%COMP%]{font-size:.98rem;padding:.6rem 1.2rem}}.info-calc-flex[_ngcontent-%COMP%]{display:flex;gap:2.2rem;align-items:flex-start;justify-content:center;margin-top:1.5rem;max-width:1200px;margin-left:auto;margin-right:auto;padding-top:3.5rem}.office-info[_ngcontent-%COMP%]{min-width:260px;max-width:340px;flex:0 0 320px;background:#e3f2fd;border-radius:14px;padding:1.3rem 1.5rem;font-size:1.04rem;color:#1976d2;box-shadow:0 2px 8px #1976d20f;display:flex;flex-direction:column;gap:.5rem}.office-info[_ngcontent-%COMP%]   .office-label[_ngcontent-%COMP%]{font-weight:600;color:#1565c0}.office-info[_ngcontent-%COMP%]   .office-value[_ngcontent-%COMP%]{font-weight:500;color:#1976d2}.calculate-container[_ngcontent-%COMP%]{flex:1 1 600px;max-width:600px;background:#f8fafc;border-radius:14px;box-shadow:0 2px 12px #1976d212;padding-top:0!important;padding-right:1.5rem;padding-bottom:2.5rem;padding-left:1.5rem}@media (max-width: 900px){.info-calc-flex[_ngcontent-%COMP%]{flex-direction:column;gap:1.2rem;margin-top:1.2rem;max-width:99vw;padding-top:3.2rem}.office-info[_ngcontent-%COMP%], .calculate-container[_ngcontent-%COMP%]{max-width:99vw;min-width:0;flex:1 1 100%;margin:0 auto}}.calc-row[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.5rem;font-size:1.04rem;color:#222;padding:.32rem .2rem;border-bottom:1px solid #e3e8ee}.calc-label[_ngcontent-%COMP%]{min-width:12em;text-align:left;font-weight:600;color:#1976d2;flex-shrink:0;margin-right:.7em}.calc-value[_ngcontent-%COMP%]{flex:1;word-break:break-all}.extra-info-row[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:1.01rem;margin-bottom:.5rem;padding:.2rem .3rem}.extra-info-label[_ngcontent-%COMP%]{min-width:6.5em;font-weight:600;color:#1976d2}.extra-info-value[_ngcontent-%COMP%]{flex:1;color:#222}.extra-info-box[_ngcontent-%COMP%]{min-width:260px;max-width:340px;background:#e3f2fd;border-radius:14px;margin-top:1.2rem;box-shadow:0 2px 8px #1976d20f;padding:1.1rem 1.2rem}"]})};export{j as CalculateComponent};
