import{a as s}from"./chunk-FUHT4GF3.js";import{d as H,f as T}from"./chunk-U6KXWGQI.js";import{Ab as f,Ac as U,Bb as S,Bc as z,Db as c,Dc as j,Ec as y,Gc as b,Hc as w,Ic as D,Kb as m,Lb as d,Oa as o,Sa as A,Ya as R,a as E,ab as M,b as P,c as v,gc as W,hb as _,ic as k,jc as N,kb as i,lb as n,mb as I,qb as O,rb as B,zb as r}from"./chunk-2AZIRXTO.js";function K(h,e){h&1&&(i(0,"div",12),r(1,"\u8A08\u7B97\u4E2D\u30FB\u30FB\u30FB"),n())}function Q(h,e){if(h&1&&(i(0,"div")(1,"div",13)(2,"span",14),r(3,"\u5065\u5EB7\u4FDD\u967A\uFF08\u5168\u984D\uFF09"),n(),i(4,"span",15),r(5),m(6,"number"),n()(),i(7,"div",13)(8,"span",14),r(9,"\u5065\u5EB7\u4FDD\u967A\uFF08\u4F1A\u793E\u8CA0\u62C5\uFF09"),n(),i(10,"span",15),r(11),m(12,"number"),n()(),i(13,"div",13)(14,"span",14),r(15,"\u5065\u5EB7\u4FDD\u967A\uFF08\u5F93\u696D\u54E1\u8CA0\u62C5\uFF09"),n(),i(16,"span",15),r(17),m(18,"number"),n()(),i(19,"div",13)(20,"span",14),r(21,"\u4ECB\u8B77\u4FDD\u967A\uFF08\u5168\u984D\uFF09"),n(),i(22,"span",15),r(23),m(24,"number"),n()(),i(25,"div",13)(26,"span",14),r(27,"\u4ECB\u8B77\u4FDD\u967A\uFF08\u4F1A\u793E\u8CA0\u62C5\uFF09"),n(),i(28,"span",15),r(29),m(30,"number"),n()(),i(31,"div",13)(32,"span",14),r(33,"\u4ECB\u8B77\u4FDD\u967A\uFF08\u5F93\u696D\u54E1\u8CA0\u62C5\uFF09"),n(),i(34,"span",15),r(35),m(36,"number"),n()(),i(37,"div",13)(38,"span",14),r(39,"\u539A\u751F\u5E74\u91D1\uFF08\u5168\u984D\uFF09"),n(),i(40,"span",15),r(41),m(42,"number"),n()(),i(43,"div",13)(44,"span",14),r(45,"\u539A\u751F\u5E74\u91D1\uFF08\u4F1A\u793E\u8CA0\u62C5\uFF09"),n(),i(46,"span",15),r(47),m(48,"number"),n()(),i(49,"div",13)(50,"span",14),r(51,"\u539A\u751F\u5E74\u91D1\uFF08\u5F93\u696D\u54E1\u8CA0\u62C5\uFF09"),n(),i(52,"span",15),r(53),m(54,"number"),n()(),i(55,"div",13)(56,"span",14),r(57,"\u5168\u984D\u5408\u8A08"),n(),i(58,"span",15),r(59),n()(),i(60,"div",13)(61,"span",14),r(62,"\u4F1A\u793E\u8CA0\u62C5\u5408\u8A08"),n(),i(63,"span",15),r(64),n()(),i(65,"div",13)(66,"span",14),r(67,"\u5F93\u696D\u54E1\u8CA0\u62C5\u5408\u8A08"),n(),i(68,"span",15),r(69),n()()()),h&2){let t=B();o(5),c("",t.standardsList.length>0?d(6,30,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.healthInsuranceRate100,"\uFF05\uFF1D",t.healthInsuranceAmount,"\u5186"),o(6),c("",t.standardsList.length>0?d(12,33,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.healthInsuranceRate100,"\uFF05\xF72\uFF1D",t.healthInsuranceAmountCompany,"\u5186"),o(6),c("",t.standardsList.length>0?d(18,36,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.healthInsuranceRate100,"\uFF05\xF72\uFF1D",t.healthInsuranceAmountEmployee,"\u5186"),o(6),c("",t.standardsList.length>0?d(24,39,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.careInsuranceRate100,"\uFF05\uFF1D",t.careInsuranceAmount,"\u5186"),o(6),c("",t.standardsList.length>0?d(30,42,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.careInsuranceRate100,"\uFF05\xF72\uFF1D",t.careInsuranceAmountCompany,"\u5186"),o(6),c("",t.standardsList.length>0?d(36,45,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.careInsuranceRate100,"\uFF05\xF72\uFF1D",t.careInsuranceAmountEmployee,"\u5186"),o(6),c("",t.standardsList.length>0?d(42,48,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].nenkinStandardMonthly,"1.0-0"):t.stdSalaryPensionWithComma,"\u5186\xD7",t.pensionInsuranceRate100,"\uFF05\uFF1D",t.pensionInsuranceAmount,"\u5186"),o(6),c("",t.standardsList.length>0?d(48,51,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].nenkinStandardMonthly,"1.0-0"):t.stdSalaryPensionWithComma,"\u5186\xD7",t.pensionInsuranceRate100,"\uFF05\xF72\uFF1D",t.pensionInsuranceAmountCompany,"\u5186"),o(6),c("",t.standardsList.length>0?d(54,54,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].nenkinStandardMonthly,"1.0-0"):t.stdSalaryPensionWithComma,"\u5186\xD7",t.pensionInsuranceRate100,"\uFF05\xF72\uFF1D",t.pensionInsuranceAmountEmployee,"\u5186"),o(6),S("",t.totalInsuranceAmount,"\u5186"),o(5),S("",t.totalInsuranceAmountCompany,"\u5186"),o(5),S("",t.totalInsuranceAmountEmployee,"\u5186")}}var $=class h{constructor(e,t,a){this.route=e;this.firestore=t;this.router=a}employeesId="";companyId="";employeeData=null;companyData=null;officeData=null;insuranceRateData=null;currentNendo=(()=>{let e=new Date,t=e.getFullYear();return e.getMonth()+1>=4?t:t-1})();standardsList=[];isLoading=!0;ngOnInit(){return v(this,null,function*(){this.isLoading=!0,this.employeesId=this.route.snapshot.paramMap.get("id")||"";let e=y(this.firestore,"companies"),t=yield D(e);for(let a of t.docs){let g=y(this.firestore,"companies",a.id,"employees"),F=yield D(g);for(let C of F.docs)if(C.id===this.employeesId){this.companyId=a.id,this.employeeData=C.data();let u=b(this.firestore,"companies",this.companyId),p=yield w(u);if(this.companyData=p.exists()?p.data():null,this.employeeData.officesId){let l=b(this.firestore,"companies",this.companyId,"offices",this.employeeData.officesId),L=yield w(l);if(this.officeData=L.exists()?L.data():null,this.officeData&&this.officeData.officePrefecture){let q=y(this.firestore,"insurance_rates"),J=yield D(q);this.insuranceRateData=J.docs.map(x=>x.data()).find(x=>x.prefecture===this.officeData.officePrefecture&&String(x.year)===String(this.currentNendo))||null}}let G=y(this.firestore,`companies/${this.companyId}/employees/${this.employeesId}/standards`),Y=yield D(G);this.standardsList=Y.docs.map(l=>E({id:l.id},l.data())),console.log("[DEBUG] standardsList:",this.standardsList.map(l=>({id:l.id,createdAt:l.createdAt,millis:l.createdAt?.toDate?l.createdAt.toDate().getTime():l.createdAt?new Date(l.createdAt).getTime():null}))),this.isLoading=!1;return}}console.log("currentNendo:",this.currentNendo),this.isLoading=!1})}get healthInsuranceRate100(){if(!this.insuranceRateData||this.insuranceRateData.health_insurance==null)return"";try{return new s(this.insuranceRateData.health_insurance).times(100).toString()}catch{return""}}get careInsuranceRate100(){if(!this.insuranceRateData||this.insuranceRateData.care_insurance==null)return"";try{return new s(this.insuranceRateData.care_insurance).times(100).toString()}catch{return""}}get pensionInsuranceRate100(){if(!this.insuranceRateData||this.insuranceRateData.pension_insurance==null)return"";try{return new s(this.insuranceRateData.pension_insurance).times(100).toString()}catch{return""}}formatWithComma(e){if(e==null||e==="")return"";let t=typeof e=="number"?e:Number(e);return isNaN(t)?"":t.toLocaleString()}get latestStandard(){if(!this.standardsList||this.standardsList.length===0)return null;let e=this.standardsList.filter(t=>!!t.createdAt);return e.length===0?null:e.map(t=>P(E({},t),{_millis:t.createdAt?.toDate?t.createdAt.toDate().getTime():t.createdAt?new Date(t.createdAt).getTime():0})).sort((t,a)=>a._millis-t._millis)[0]}get healthInsuranceAmount(){if(!this.insuranceRateData)return"";let e=this.latestStandard?.kenpoStandardMonthly??(this.employeeData?this.employeeData.stdSalaryHealth:null),t=this.insuranceRateData.health_insurance;if(e==null||t==null)return"";try{return this.formatWithComma(new s(e).times(new s(t)).toDecimalPlaces(0,s.ROUND_HALF_UP).toString())}catch{return""}}get pensionInsuranceAmount(){if(!this.insuranceRateData)return"";let e=this.latestStandard?.nenkinStandardMonthly??(this.employeeData?this.employeeData.stdSalaryPension:null),t=this.insuranceRateData.pension_insurance;if(e==null||t==null)return"";try{return this.formatWithComma(new s(e).times(new s(t)).toFixed(0))}catch{return""}}get healthInsuranceAmountCompany(){let e=this.healthInsuranceAmount.replace(/,/g,"");if(!e)return"";try{return this.formatWithComma(new s(e).div(2).toDecimalPlaces(0,s.ROUND_HALF_UP).toString())}catch{return""}}get healthInsuranceAmountEmployee(){let e=this.healthInsuranceAmount.replace(/,/g,"");if(!e)return"";try{let t=new s(e).div(2);return t.minus(t.floor()).times(10).toNumber()<=5?this.formatWithComma(t.floor().toString()):this.formatWithComma(t.ceil().toString())}catch{return""}}get pensionInsuranceAmountCompany(){let e=this.pensionInsuranceAmount.replace(/,/g,"");if(!e)return"";try{return this.formatWithComma(new s(e).div(2).toDecimalPlaces(0,s.ROUND_HALF_UP).toString())}catch{return""}}get pensionInsuranceAmountEmployee(){let e=this.pensionInsuranceAmount.replace(/,/g,"");if(!e)return"";try{let t=new s(e).div(2);return t.minus(t.floor()).times(10).toNumber()<=5?this.formatWithComma(t.floor().toString()):this.formatWithComma(t.ceil().toString())}catch{return""}}get careInsuranceAmount(){if(!this.insuranceRateData)return"";let e=this.latestStandard?.kenpoStandardMonthly??(this.employeeData?this.employeeData.stdSalaryHealth:null),t=this.insuranceRateData.care_insurance;if(e==null||t==null)return"";try{return this.formatWithComma(new s(e).times(new s(t)).toDecimalPlaces(0,s.ROUND_HALF_UP).toString())}catch{return""}}get careInsuranceAmountCompany(){let e=this.careInsuranceAmount.replace(/,/g,"");if(!e)return"";try{return this.formatWithComma(new s(e).div(2).toDecimalPlaces(0,s.ROUND_HALF_UP).toString())}catch{return""}}get careInsuranceAmountEmployee(){let e=this.careInsuranceAmount.replace(/,/g,"");if(!e)return"";try{let t=new s(e).div(2);return t.minus(t.floor()).times(10).toNumber()<=5?this.formatWithComma(t.floor().toString()):this.formatWithComma(t.ceil().toString())}catch{return""}}get totalInsuranceAmount(){let e=this.healthInsuranceAmount.replace(/,/g,""),t=this.pensionInsuranceAmount.replace(/,/g,""),a=this.careInsuranceAmount.replace(/,/g,"");if(!e&&!t&&!a)return"";try{return this.formatWithComma(new s(e||0).plus(new s(t||0)).plus(new s(a||0)).toString())}catch{return""}}get totalInsuranceAmountCompany(){let e=this.healthInsuranceAmountCompany.replace(/,/g,""),t=this.pensionInsuranceAmountCompany.replace(/,/g,""),a=this.careInsuranceAmountCompany.replace(/,/g,"");if(!e&&!t&&!a)return"";try{return this.formatWithComma(new s(e||0).plus(new s(t||0)).plus(new s(a||0)).toString())}catch{return""}}get totalInsuranceAmountEmployee(){let e=this.healthInsuranceAmountEmployee.replace(/,/g,""),t=this.pensionInsuranceAmountEmployee.replace(/,/g,""),a=this.careInsuranceAmountEmployee.replace(/,/g,"");if(!e&&!t&&!a)return"";try{return this.formatWithComma(new s(e||0).plus(new s(t||0)).plus(new s(a||0)).toString())}catch{return""}}get stdSalaryHealthWithComma(){return!this.employeeData||this.employeeData.stdSalaryHealth==null?"":this.formatWithComma(this.employeeData.stdSalaryHealth)}get stdSalaryPensionWithComma(){return!this.employeeData||this.employeeData.stdSalaryPension==null?"":this.formatWithComma(this.employeeData.stdSalaryPension)}onSaveCalc=()=>v(this,null,function*(){if(!this.employeesId)return;let e=y(this.firestore,"companies",this.companyId,"employees",this.employeesId,"insurances"),t=yield D(e),a={},g=null;t.forEach(C=>{let u=C.data();(!g||u.createdAt&&u.createdAt.toMillis&&u.createdAt.toMillis()>g)&&(g=u.createdAt&&u.createdAt.toMillis?u.createdAt.toMillis():null,a=u)});let F={healthInsuranceTotal:this.healthInsuranceAmount.replace(/,/g,""),healthInsuranceCompany:this.healthInsuranceAmountCompany.replace(/,/g,""),healthInsuranceEmployee:this.healthInsuranceAmountEmployee.replace(/,/g,""),careInsuranceTotal:this.careInsuranceAmount.replace(/,/g,""),careInsuranceCompany:this.careInsuranceAmountCompany.replace(/,/g,""),careInsuranceEmployee:this.careInsuranceAmountEmployee.replace(/,/g,""),pensionInsuranceTotal:this.pensionInsuranceAmount.replace(/,/g,""),pensionInsuranceCompany:this.pensionInsuranceAmountCompany.replace(/,/g,""),pensionInsuranceEmployee:this.pensionInsuranceAmountEmployee.replace(/,/g,""),total:this.totalInsuranceAmount.replace(/,/g,""),totalCompany:this.totalInsuranceAmountCompany.replace(/,/g,""),totalEmployee:this.totalInsuranceAmountEmployee.replace(/,/g,""),employeeId:this.employeesId,createdAt:U()};Object.keys(a).length>0&&Object.keys(F).filter(p=>p!=="createdAt"&&p!=="createdBy").every(p=>String(F[p])===String(a[p]))||(yield j(e,F),this.router.navigate(["/employee-detail",this.employeesId]))});static \u0275fac=function(t){return new(t||h)(A(H),A(z),A(T))};static \u0275cmp=R({type:h,selectors:[["app-calculate"]],decls:46,vars:7,consts:[[1,"info-calc-flex"],[1,"office-info"],[1,"office-label"],[1,"office-value"],[1,"extra-info-box"],[1,"extra-info-row"],[1,"extra-info-label"],[1,"extra-info-value"],[1,"calculate-container"],["type","button",1,"save-calc-btn",3,"click"],["class","loading-message",4,"ngIf"],[4,"ngIf"],[1,"loading-message"],[1,"calc-row"],[1,"calc-label"],[1,"calc-value"]],template:function(t,a){t&1&&(i(0,"div",0)(1,"div")(2,"div",1)(3,"div")(4,"span",2),r(5,"\u6240\u5C5E\u4E8B\u696D\u6240\uFF1A"),n(),i(6,"span",3),r(7),n()(),i(8,"div")(9,"span",2),r(10,"\u6240\u5728\u90FD\u9053\u5E9C\u770C\uFF1A"),n(),i(11,"span",3),r(12),n()(),i(13,"div")(14,"span",2),r(15,"\u5065\u5EB7\u4FDD\u967A\u6599\u7387\uFF1A"),n(),i(16,"span",3),r(17),n()(),i(18,"div")(19,"span",2),r(20,"\u4ECB\u8B77\u4FDD\u967A\u6599\u7387\uFF1A"),n(),i(21,"span",3),r(22),n()(),i(23,"div")(24,"span",2),r(25,"\u539A\u751F\u5E74\u91D1\u4FDD\u967A\u6599\u7387\uFF1A"),n(),i(26,"span",3),r(27),n()()(),i(28,"div",4)(29,"div",5)(30,"span",6),r(31,"\u5065\u5EB7\u4FDD\u967A\u5BFE\u8C61\uFF1A"),n(),I(32,"span",7),n(),i(33,"div",5)(34,"span",6),r(35,"\u4ECB\u8B77\u4FDD\u967A\uFF1A"),n(),I(36,"span",7),n(),i(37,"div",5)(38,"span",6),r(39,"\u539A\u751F\u5E74\u91D1\u5BFE\u8C61\uFF1A"),n(),I(40,"span",7),n()()(),i(41,"div",8)(42,"button",9),O("click",function(){return a.onSaveCalc()}),r(43,"\u8A08\u7B97\u7D50\u679C\u3092\u4FDD\u5B58"),n(),M(44,K,2,0,"div",10)(45,Q,70,57,"div",11),n()()),t&2&&(o(7),f((a.officeData==null?null:a.officeData.officeName)||"---"),o(5),f((a.officeData==null?null:a.officeData.officePrefecture)||"---"),o(5),f(a.insuranceRateData!=null&&a.insuranceRateData.health_insurance?a.insuranceRateData.health_insurance*100+"\uFF05":"---"),o(5),f(a.insuranceRateData!=null&&a.insuranceRateData.care_insurance?a.insuranceRateData.care_insurance*100+"\uFF05":"---"),o(5),f(a.insuranceRateData!=null&&a.insuranceRateData.pension_insurance?a.insuranceRateData.pension_insurance*100+"\uFF05":"---"),o(17),_("ngIf",a.isLoading),o(),_("ngIf",!a.isLoading&&a.employeeData))},dependencies:[N,W,k],styles:[".calculate-container[_ngcontent-%COMP%]{padding-top:4rem;max-width:600px;margin:0 auto;background:#f8fafc;border-radius:12px;box-shadow:0 2px 12px #1976d212;padding-bottom:2.5rem}.calculate-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:1.2rem}.calculate-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:1.04rem;color:#222;padding:.32rem .2rem;border-bottom:1px solid #e3e8ee}.calculate-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child{border-bottom:none}.calculate-container[_ngcontent-%COMP%]   .loading-message[_ngcontent-%COMP%]{text-align:center;font-size:1.08rem;color:#1976d2;padding:2.5rem 0;font-weight:600}.save-calc-btn[_ngcontent-%COMP%]{display:block;margin:.1rem auto;background:#1976d2;color:#fff;font-size:.95rem;font-weight:600;padding:.4rem 1.2rem;border:none;border-radius:7px;cursor:pointer;box-shadow:0 1px 4px #1976d214;transition:background .2s}.save-calc-btn[_ngcontent-%COMP%]:hover{background:#1565c0}@media (max-width: 600px){.calculate-container[_ngcontent-%COMP%]{padding:1.2rem .5rem 2rem;max-width:99vw}.calculate-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:.98rem}.save-calc-btn[_ngcontent-%COMP%]{font-size:.98rem;padding:.6rem 1.2rem}}.info-calc-flex[_ngcontent-%COMP%]{display:flex;gap:2.2rem;align-items:flex-start;justify-content:center;margin-top:1.5rem;max-width:1200px;margin-left:auto;margin-right:auto;padding-top:3.5rem}.office-info[_ngcontent-%COMP%]{min-width:260px;max-width:340px;flex:0 0 320px;background:#e3f2fd;border-radius:14px;padding:1.3rem 1.5rem;font-size:1.04rem;color:#1976d2;box-shadow:0 2px 8px #1976d20f;display:flex;flex-direction:column;gap:.5rem}.office-info[_ngcontent-%COMP%]   .office-label[_ngcontent-%COMP%]{font-weight:600;color:#1565c0}.office-info[_ngcontent-%COMP%]   .office-value[_ngcontent-%COMP%]{font-weight:500;color:#1976d2}.calculate-container[_ngcontent-%COMP%]{flex:1 1 600px;max-width:600px;background:#f8fafc;border-radius:14px;box-shadow:0 2px 12px #1976d212;padding-top:0!important;padding-right:1.5rem;padding-bottom:2.5rem;padding-left:1.5rem}@media (max-width: 900px){.info-calc-flex[_ngcontent-%COMP%]{flex-direction:column;gap:1.2rem;margin-top:1.2rem;max-width:99vw;padding-top:3.2rem}.office-info[_ngcontent-%COMP%], .calculate-container[_ngcontent-%COMP%]{max-width:99vw;min-width:0;flex:1 1 100%;margin:0 auto}}.calc-row[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.5rem;font-size:1.04rem;color:#222;padding:.32rem .2rem;border-bottom:1px solid #e3e8ee}.calc-label[_ngcontent-%COMP%]{min-width:12em;text-align:left;font-weight:600;color:#1976d2;flex-shrink:0;margin-right:.7em}.calc-value[_ngcontent-%COMP%]{flex:1;word-break:break-all}.extra-info-row[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:1.01rem;margin-bottom:.5rem;padding:.2rem .3rem}.extra-info-label[_ngcontent-%COMP%]{min-width:6.5em;font-weight:600;color:#1976d2}.extra-info-value[_ngcontent-%COMP%]{flex:1;color:#222}.extra-info-box[_ngcontent-%COMP%]{min-width:260px;max-width:340px;background:#e3f2fd;border-radius:14px;margin-top:1.2rem;box-shadow:0 2px 8px #1976d20f;padding:1.1rem 1.2rem}"]})};export{$ as CalculateComponent};
