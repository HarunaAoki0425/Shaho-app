import{a as n}from"./chunk-FUHT4GF3.js";import{d as N}from"./chunk-MKMZI2YY.js";import{F as k,G as H,I as O,J as p,L,M as E,N as y,l as b,n as M,o as B}from"./chunk-BPK4PEFJ.js";import{Eb as W,Fb as P,Nb as o,Pb as A,Rb as l,Xa as i,Yb as c,Zb as m,a as R,ab as S,d as C,gb as w,lb as x,sb as _,wb as s,xb as r}from"./chunk-5ATSOUQY.js";function q(g,e){if(g&1&&(s(0,"div")(1,"div"),o(2),c(3,"number"),r(),s(4,"div"),o(5),c(6,"number"),r(),s(7,"div"),o(8),c(9,"number"),r(),s(10,"div"),o(11),c(12,"number"),r(),s(13,"div"),o(14),c(15,"number"),r(),s(16,"div"),o(17),c(18,"number"),r(),s(19,"div"),o(20),c(21,"number"),r(),s(22,"div"),o(23),c(24,"number"),r(),s(25,"div"),o(26),c(27,"number"),r(),s(28,"div"),o(29),r(),s(30,"div"),o(31),r(),s(32,"div"),o(33),r()()),g&2){let t=P();i(2),l("\u5065\u5EB7\u4FDD\u967A\uFF08\u5168\u984D\uFF09: ",t.standardsList.length>0?m(3,30,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.healthInsuranceRate100,"\uFF05\uFF1D",t.healthInsuranceAmount,"\u5186"),i(3),l("\u5065\u5EB7\u4FDD\u967A\uFF08\u4F1A\u793E\u8CA0\u62C5\uFF09: ",t.standardsList.length>0?m(6,33,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.healthInsuranceRate100,"\uFF05\xF72\uFF1D",t.healthInsuranceAmountCompany,"\u5186"),i(3),l("\u5065\u5EB7\u4FDD\u967A\uFF08\u5F93\u696D\u54E1\u8CA0\u62C5\uFF09: ",t.standardsList.length>0?m(9,36,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.healthInsuranceRate100,"\uFF05\xF72\uFF1D",t.healthInsuranceAmountEmployee,"\u5186"),i(3),l("\u4ECB\u8B77\u4FDD\u967A\uFF08\u5168\u984D\uFF09: ",t.standardsList.length>0?m(12,39,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.careInsuranceRate100,"\uFF05\uFF1D",t.careInsuranceAmount,"\u5186"),i(3),l("\u4ECB\u8B77\u4FDD\u967A\uFF08\u4F1A\u793E\u8CA0\u62C5\uFF09: ",t.standardsList.length>0?m(15,42,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.careInsuranceRate100,"\uFF05\xF72\uFF1D",t.careInsuranceAmountCompany,"\u5186"),i(3),l("\u4ECB\u8B77\u4FDD\u967A\uFF08\u5F93\u696D\u54E1\u8CA0\u62C5\uFF09: ",t.standardsList.length>0?m(18,45,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].kenpoStandardMonthly,"1.0-0"):t.stdSalaryHealthWithComma,"\u5186\xD7",t.careInsuranceRate100,"\uFF05\xF72\uFF1D",t.careInsuranceAmountEmployee,"\u5186"),i(3),l("\u539A\u751F\u5E74\u91D1\uFF08\u5168\u984D\uFF09: ",t.standardsList.length>0?m(21,48,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].nenkinStandardMonthly,"1.0-0"):t.stdSalaryPensionWithComma,"\u5186\xD7",t.pensionInsuranceRate100,"\uFF05\uFF1D",t.pensionInsuranceAmount,"\u5186"),i(3),l("\u539A\u751F\u5E74\u91D1\uFF08\u4F1A\u793E\u8CA0\u62C5\uFF09: ",t.standardsList.length>0?m(24,51,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].nenkinStandardMonthly,"1.0-0"):t.stdSalaryPensionWithComma,"\u5186\xD7",t.pensionInsuranceRate100,"\uFF05\xF72\uFF1D",t.pensionInsuranceAmountCompany,"\u5186"),i(3),l("\u539A\u751F\u5E74\u91D1\uFF08\u5F93\u696D\u54E1\u8CA0\u62C5\uFF09: ",t.standardsList.length>0?m(27,54,t.standardsList[t.standardsList.length-1]==null?null:t.standardsList[t.standardsList.length-1].nenkinStandardMonthly,"1.0-0"):t.stdSalaryPensionWithComma,"\u5186\xD7",t.pensionInsuranceRate100,"\uFF05\xF72\uFF1D",t.pensionInsuranceAmountEmployee,"\u5186"),i(3),A("\u5168\u984D\u5408\u8A08: ",t.totalInsuranceAmount,"\u5186"),i(2),A("\u4F1A\u793E\u8CA0\u62C5\u5408\u8A08: ",t.totalInsuranceAmountCompany,"\u5186"),i(2),A("\u5F93\u696D\u54E1\u8CA0\u62C5\u5408\u8A08: ",t.totalInsuranceAmountEmployee,"\u5186")}}var U=class g{constructor(e,t){this.route=e;this.firestore=t}employeesId="";companyId="";employeeData=null;companyData=null;officeData=null;insuranceRateData=null;currentNendo=(()=>{let e=new Date,t=e.getFullYear();return e.getMonth()+1>=4?t:t-1})();standardsList=[];ngOnInit(){return C(this,null,function*(){this.employeesId=this.route.snapshot.paramMap.get("id")||"";let e=p(this.firestore,"companies"),t=yield y(e);for(let a of t.docs){let h=p(this.firestore,"companies",a.id,"employees"),f=yield y(h);for(let I of f.docs)if(I.id===this.employeesId){this.companyId=a.id,this.employeeData=I.data();let u=L(this.firestore,"companies",this.companyId),d=yield E(u);if(this.companyData=d.exists()?d.data():null,this.employeeData.officesId){let D=L(this.firestore,"companies",this.companyId,"offices",this.employeeData.officesId),v=yield E(D);if(this.officeData=v.exists()?v.data():null,this.officeData&&this.officeData.officePrefecture){let $=p(this.firestore,"insurance_rates"),Y=yield y($);this.insuranceRateData=Y.docs.map(F=>F.data()).find(F=>F.prefecture===this.officeData.officePrefecture&&String(F.year)===String(this.currentNendo))||null}}let T=p(this.firestore,`companies/${this.companyId}/employees/${this.employeesId}/standards`),j=yield y(T);this.standardsList=j.docs.map(D=>R({id:D.id},D.data()));return}}console.log("currentNendo:",this.currentNendo)})}get healthInsuranceRate100(){if(!this.insuranceRateData||this.insuranceRateData.health_insurance==null)return"";try{return new n(this.insuranceRateData.health_insurance).times(100).toString()}catch{return""}}get careInsuranceRate100(){if(!this.insuranceRateData||this.insuranceRateData.care_insurance==null)return"";try{return new n(this.insuranceRateData.care_insurance).times(100).toString()}catch{return""}}get pensionInsuranceRate100(){if(!this.insuranceRateData||this.insuranceRateData.pension_insurance==null)return"";try{return new n(this.insuranceRateData.pension_insurance).times(100).toString()}catch{return""}}formatWithComma(e){if(e==null||e==="")return"";let t=typeof e=="number"?e:Number(e);return isNaN(t)?"":t.toLocaleString()}get healthInsuranceAmount(){if(!this.insuranceRateData)return"";let e=this.standardsList.length>0?this.standardsList[this.standardsList.length-1].kenpoStandardMonthly:this.employeeData?this.employeeData.stdSalaryHealth:null,t=this.insuranceRateData.health_insurance;if(e==null||t==null)return"";try{return this.formatWithComma(new n(e).times(new n(t)).toDecimalPlaces(0,n.ROUND_HALF_UP).toString())}catch{return""}}get pensionInsuranceAmount(){if(!this.insuranceRateData)return"";let e=this.standardsList.length>0?this.standardsList[this.standardsList.length-1].nenkinStandardMonthly:this.employeeData?this.employeeData.stdSalaryPension:null,t=this.insuranceRateData.pension_insurance;if(e==null||t==null)return"";try{return this.formatWithComma(new n(e).times(new n(t)).toFixed(0))}catch{return""}}get healthInsuranceAmountCompany(){let e=this.healthInsuranceAmount.replace(/,/g,"");if(!e)return"";try{return this.formatWithComma(new n(e).div(2).toDecimalPlaces(0,n.ROUND_HALF_UP).toString())}catch{return""}}get healthInsuranceAmountEmployee(){let e=this.healthInsuranceAmount.replace(/,/g,"");if(!e)return"";try{let t=new n(e).div(2);return t.minus(t.floor()).times(10).toNumber()<=5?this.formatWithComma(t.floor().toString()):this.formatWithComma(t.ceil().toString())}catch{return""}}get pensionInsuranceAmountCompany(){let e=this.pensionInsuranceAmount.replace(/,/g,"");if(!e)return"";try{return this.formatWithComma(new n(e).div(2).toDecimalPlaces(0,n.ROUND_HALF_UP).toString())}catch{return""}}get pensionInsuranceAmountEmployee(){let e=this.pensionInsuranceAmount.replace(/,/g,"");if(!e)return"";try{let t=new n(e).div(2);return t.minus(t.floor()).times(10).toNumber()<=5?this.formatWithComma(t.floor().toString()):this.formatWithComma(t.ceil().toString())}catch{return""}}get careInsuranceAmount(){if(!this.insuranceRateData)return"";let e=this.standardsList.length>0?this.standardsList[this.standardsList.length-1].kenpoStandardMonthly:this.employeeData?this.employeeData.stdSalaryHealth:null,t=this.insuranceRateData.care_insurance;if(e==null||t==null)return"";try{return this.formatWithComma(new n(e).times(new n(t)).toDecimalPlaces(0,n.ROUND_HALF_UP).toString())}catch{return""}}get careInsuranceAmountCompany(){let e=this.careInsuranceAmount.replace(/,/g,"");if(!e)return"";try{return this.formatWithComma(new n(e).div(2).toDecimalPlaces(0,n.ROUND_HALF_UP).toString())}catch{return""}}get careInsuranceAmountEmployee(){let e=this.careInsuranceAmount.replace(/,/g,"");if(!e)return"";try{let t=new n(e).div(2);return t.minus(t.floor()).times(10).toNumber()<=5?this.formatWithComma(t.floor().toString()):this.formatWithComma(t.ceil().toString())}catch{return""}}get totalInsuranceAmount(){let e=this.healthInsuranceAmount.replace(/,/g,""),t=this.pensionInsuranceAmount.replace(/,/g,""),a=this.careInsuranceAmount.replace(/,/g,"");if(!e&&!t&&!a)return"";try{return this.formatWithComma(new n(e||0).plus(new n(t||0)).plus(new n(a||0)).toString())}catch{return""}}get totalInsuranceAmountCompany(){let e=this.healthInsuranceAmountCompany.replace(/,/g,""),t=this.pensionInsuranceAmountCompany.replace(/,/g,""),a=this.careInsuranceAmountCompany.replace(/,/g,"");if(!e&&!t&&!a)return"";try{return this.formatWithComma(new n(e||0).plus(new n(t||0)).plus(new n(a||0)).toString())}catch{return""}}get totalInsuranceAmountEmployee(){let e=this.healthInsuranceAmountEmployee.replace(/,/g,""),t=this.pensionInsuranceAmountEmployee.replace(/,/g,""),a=this.careInsuranceAmountEmployee.replace(/,/g,"");if(!e&&!t&&!a)return"";try{return this.formatWithComma(new n(e||0).plus(new n(t||0)).plus(new n(a||0)).toString())}catch{return""}}get stdSalaryHealthWithComma(){return!this.employeeData||this.employeeData.stdSalaryHealth==null?"":this.formatWithComma(this.employeeData.stdSalaryHealth)}get stdSalaryPensionWithComma(){return!this.employeeData||this.employeeData.stdSalaryPension==null?"":this.formatWithComma(this.employeeData.stdSalaryPension)}onSaveCalc=()=>C(this,null,function*(){if(!this.employeesId)return;let e=p(this.firestore,"companies",this.companyId,"employees",this.employeesId,"insurances"),t=yield y(e),a={},h=null;t.forEach(I=>{let u=I.data();(!h||u.createdAt&&u.createdAt.toMillis&&u.createdAt.toMillis()>h)&&(h=u.createdAt&&u.createdAt.toMillis?u.createdAt.toMillis():null,a=u)});let f={healthInsuranceTotal:this.healthInsuranceAmount.replace(/,/g,""),healthInsuranceCompany:this.healthInsuranceAmountCompany.replace(/,/g,""),healthInsuranceEmployee:this.healthInsuranceAmountEmployee.replace(/,/g,""),careInsuranceTotal:this.careInsuranceAmount.replace(/,/g,""),careInsuranceCompany:this.careInsuranceAmountCompany.replace(/,/g,""),careInsuranceEmployee:this.careInsuranceAmountEmployee.replace(/,/g,""),pensionInsuranceTotal:this.pensionInsuranceAmount.replace(/,/g,""),pensionInsuranceCompany:this.pensionInsuranceAmountCompany.replace(/,/g,""),pensionInsuranceEmployee:this.pensionInsuranceAmountEmployee.replace(/,/g,""),total:this.totalInsuranceAmount.replace(/,/g,""),totalCompany:this.totalInsuranceAmountCompany.replace(/,/g,""),totalEmployee:this.totalInsuranceAmountEmployee.replace(/,/g,""),employeeId:this.employeesId,createdAt:k()};Object.keys(a).length>0&&Object.keys(f).filter(d=>d!=="createdAt"&&d!=="createdBy").every(d=>String(f[d])===String(a[d]))||(yield O(e,f))});static \u0275fac=function(t){return new(t||g)(S(N),S(H))};static \u0275cmp=w({type:g,selectors:[["app-calculate"]],decls:4,vars:1,consts:[[1,"calculate-container"],[4,"ngIf"],["type","button",1,"save-calc-btn",3,"click"]],template:function(t,a){t&1&&(s(0,"div",0),x(1,q,34,57,"div",1),s(2,"button",2),W("click",function(){return a.onSaveCalc()}),o(3,"\u8A08\u7B97\u7D50\u679C\u3092\u4FDD\u5B58"),r()()),t&2&&(i(),_("ngIf",a.employeeData))},dependencies:[B,b,M],styles:[".calculate-container[_ngcontent-%COMP%]{padding-top:4rem}"]})};export{U as CalculateComponent};
