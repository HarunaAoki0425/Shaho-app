import{b as K,c as Q,f as G,p as H}from"./chunk-FSLVCKVZ.js";import{f as N}from"./chunk-NJLM6MAR.js";import{Ae as b,Bc as R,Cb as a,Cc as U,Db as F,Dc as L,Eb as V,Ec as j,Hb as P,Hc as q,Ib as S,Jb as v,Md as J,Pa as s,Pe as X,Za as D,_ as O,bb as g,cf as Y,d as E,fa as u,fe as x,ga as l,ib as f,je as h,kc as T,mb as n,nb as r,ne as _,ob as C,oc as W,pb as B,qb as I,sb as A,tb as w,ub as c,xc as z}from"./chunk-6AHFQYIP.js";function at(o,i){if(o&1&&(n(0,"div",6),B(1),n(2,"div")(3,"strong"),a(4,"\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9:"),r(),a(5),r(),I(),r()),o&2){let t=c();s(5),V(" ",t.user.email,"")}}function dt(o,i){if(o&1){let t=A();n(0,"button",7),w("click",function(){u(t);let e=c();return l(e.onResetPassword())}),a(1,"\u30D1\u30B9\u30EF\u30FC\u30C9\u518D\u8A2D\u5B9A"),r()}}function ct(o,i){if(o&1&&(n(0,"div",16),a(1),r()),o&2){let t=c(2);s(),F(t.passwordError)}}function pt(o,i){if(o&1&&(n(0,"div",17),a(1),r()),o&2){let t=c(2);s(),F(t.passwordSuccess)}}function mt(o,i){if(o&1){let t=A();n(0,"div",8),g(1,ct,2,1,"div",9)(2,pt,2,1,"div",10),n(3,"div",11)(4,"label"),a(5,"\u73FE\u5728\u306E\u30D1\u30B9\u30EF\u30FC\u30C9"),C(6,"br"),n(7,"input",12),v("ngModelChange",function(e){u(t);let p=c();return S(p.currentPassword,e)||(p.currentPassword=e),l(e)}),r()()(),n(8,"div",11)(9,"label"),a(10,"\u65B0\u3057\u3044\u30D1\u30B9\u30EF\u30FC\u30C9"),C(11,"br"),n(12,"input",12),v("ngModelChange",function(e){u(t);let p=c();return S(p.newPassword,e)||(p.newPassword=e),l(e)}),r()()(),n(13,"div",13)(14,"label"),a(15,"\u65B0\u3057\u3044\u30D1\u30B9\u30EF\u30FC\u30C9\uFF08\u78BA\u8A8D\uFF09"),C(16,"br"),n(17,"input",12),v("ngModelChange",function(e){u(t);let p=c();return S(p.confirmPassword,e)||(p.confirmPassword=e),l(e)}),r()()(),n(18,"button",14),w("click",function(){u(t);let e=c();return l(e.onSubmitPasswordReset())}),a(19,"\u4FDD\u5B58"),r(),n(20,"button",15),w("click",function(){u(t);let e=c();return l(e.showPasswordForm=!1)}),a(21,"\u30AD\u30E3\u30F3\u30BB\u30EB"),r()()}if(o&2){let t=c();s(),f("ngIf",t.passwordError),s(),f("ngIf",t.passwordSuccess&&!t.showPasswordForm),s(5),P("ngModel",t.currentPassword),s(5),P("ngModel",t.newPassword),s(5),P("ngModel",t.confirmPassword),s(),f("disabled",!t.canSavePassword)}}var Z=class o{user=null;isEditUser=!1;userName="";userEmail="";showPasswordForm=!1;currentPassword="";newPassword="";confirmPassword="";passwordError="";passwordSuccess="";isSavingPassword=!1;firestore=O(J);router=O(N);constructor(){}ngOnInit(){let i=U();L(i,t=>{this.user=t,this.userName=t?.displayName||"",this.userEmail=t?.email||"",console.log("[admin-setting] \u30ED\u30B0\u30A4\u30F3\u30E6\u30FC\u30B6\u30FC:",this.user),t||this.router.navigate(["/login"])})}get canSavePassword(){return!!this.currentPassword&&!!this.newPassword&&!!this.confirmPassword&&this.newPassword===this.confirmPassword&&this.newPassword.length>=6&&!this.isSavingPassword}onResetPassword(){this.showPasswordForm=!0,this.currentPassword="",this.newPassword="",this.confirmPassword="",this.passwordError="",this.passwordSuccess=""}onSubmitPasswordReset(){return E(this,null,function*(){if(this.passwordError="",this.passwordSuccess="",!this.user||!this.user.email){this.passwordError="\u30E6\u30FC\u30B6\u30FC\u60C5\u5831\u304C\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3002";return}if(this.newPassword!==this.confirmPassword){this.passwordError="\u65B0\u3057\u3044\u30D1\u30B9\u30EF\u30FC\u30C9\u304C\u4E00\u81F4\u3057\u307E\u305B\u3093\u3002";return}if(this.newPassword.length<6){this.passwordError="\u65B0\u3057\u3044\u30D1\u30B9\u30EF\u30FC\u30C9\u306F6\u6587\u5B57\u4EE5\u4E0A\u3067\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002";return}this.isSavingPassword=!0;try{let i=z.credential(this.user.email,this.currentPassword);yield j(this.user,i),yield q(this.user,this.newPassword),this.passwordSuccess="",this.showPasswordForm=!1,alert("\u30D1\u30B9\u30EF\u30FC\u30C9\u304C\u5909\u66F4\u3055\u308C\u307E\u3057\u305F\u3002")}catch(i){i.code==="auth/wrong-password"?this.passwordError="\u73FE\u5728\u306E\u30D1\u30B9\u30EF\u30FC\u30C9\u304C\u6B63\u3057\u304F\u3042\u308A\u307E\u305B\u3093\u3002":this.passwordError="\u30D1\u30B9\u30EF\u30FC\u30C9\u5909\u66F4\u306B\u5931\u6557\u3057\u307E\u3057\u305F: "+(i.message||i.code)}finally{this.isSavingPassword=!1}})}onDeleteAccount(){return E(this,null,function*(){if(!(!this.user||!confirm(`\u672C\u5F53\u306B\u30A2\u30AB\u30A6\u30F3\u30C8\u3092\u524A\u9664\u3057\u307E\u3059\u304B\uFF1F

\u3053\u306E\u64CD\u4F5C\u306F\u53D6\u308A\u6D88\u305B\u307E\u305B\u3093\u3002

\u4F1A\u793E\u60C5\u5831\u30FB\u5F93\u696D\u54E1\u60C5\u5831\u306A\u3069\u3001\u3042\u306A\u305F\u304C\u4F5C\u6210\u3057\u305F\u5168\u3066\u306E\u30C7\u30FC\u30BF\u304C\u5B8C\u5168\u306B\u524A\u9664\u3055\u308C\u307E\u3059\u3002

\u3088\u308D\u3057\u3051\u308C\u3070OK\u3092\u62BC\u3057\u3066\u304F\u3060\u3055\u3044\u3002`)))try{let t=x(this.firestore,"companies"),d=X(t,Y("createdBy","==",this.user.uid)),e=yield b(d);for(let p of e.docs){let m=p.id,$=x(this.firestore,"companies",m,"employees"),tt=yield b($);for(let y of tt.docs){let M=y.id,ot=["insurances","standards","bonus"];for(let k of ot){let it=x(this.firestore,"companies",m,"employees",M,k),rt=yield b(it);for(let st of rt.docs)yield h(_(this.firestore,"companies",m,"employees",M,k,st.id))}yield h(_(this.firestore,"companies",m,"employees",M))}let et=x(this.firestore,"companies",m,"offices"),nt=yield b(et);for(let y of nt.docs)yield h(_(this.firestore,"companies",m,"offices",y.id));yield h(_(this.firestore,"companies",m))}yield R(this.user),alert("\u30A2\u30AB\u30A6\u30F3\u30C8\u3068\u95A2\u9023\u30C7\u30FC\u30BF\u304C\u5168\u3066\u524A\u9664\u3055\u308C\u307E\u3057\u305F\u3002\u3054\u5229\u7528\u3042\u308A\u304C\u3068\u3046\u3054\u3056\u3044\u307E\u3057\u305F\u3002"),window.location.href="/"}catch(t){alert("\u30A2\u30AB\u30A6\u30F3\u30C8\u524A\u9664\u306B\u5931\u6557\u3057\u307E\u3057\u305F: "+(t.message||t.code))}})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=D({type:o,selectors:[["app-admin-setting"]],decls:9,vars:3,consts:[[1,"admin-setting-container"],["class","user-info","style","position: relative; padding-right: 48px;",4,"ngIf"],[1,"button-row"],["class","reset-password-btn",3,"click",4,"ngIf"],[1,"delete-account-btn",3,"click"],["class","password-reset-form","style","margin-top: 16px; max-width: 340px;",4,"ngIf"],[1,"user-info",2,"position","relative","padding-right","48px"],[1,"reset-password-btn",3,"click"],[1,"password-reset-form",2,"margin-top","16px","max-width","340px"],["style","color: #d32f2f; margin-bottom: 8px;",4,"ngIf"],["style","color: #388e3c; margin-top: 16px; font-weight: bold;",4,"ngIf"],[2,"margin-bottom","10px"],["type","password",2,"width","100%","padding","6px",3,"ngModelChange","ngModel"],[2,"margin-bottom","16px"],[1,"edit-user-btn",2,"margin-right","8px",3,"click","disabled"],[1,"edit-user-btn",2,"background","#eee","color","#555",3,"click"],[2,"color","#d32f2f","margin-bottom","8px"],[2,"color","#388e3c","margin-top","16px","font-weight","bold"]],template:function(t,d){t&1&&(n(0,"div",0)(1,"h1"),a(2,"\u30E6\u30FC\u30B6\u30FC\u8A2D\u5B9A"),r(),g(3,at,6,1,"div",1),n(4,"div",2),g(5,dt,2,0,"button",3),n(6,"button",4),w("click",function(){return d.onDeleteAccount()}),a(7,"\u30A2\u30AB\u30A6\u30F3\u30C8\u524A\u9664"),r()(),g(8,mt,22,6,"div",5),r()),t&2&&(s(3),f("ngIf",d.user),s(2),f("ngIf",!d.showPasswordForm),s(3),f("ngIf",d.showPasswordForm))},dependencies:[W,T,H,K,Q,G],styles:[".admin-setting-container[_ngcontent-%COMP%]{max-width:600px;margin:40px auto;background:#fff;border-radius:12px;box-shadow:0 2px 12px #1976d214;padding:32px 28px 24px}.admin-setting-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#1976d2;font-size:2em;margin-bottom:12px}.admin-setting-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#444;margin-bottom:24px}.setting-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.2em;margin-bottom:8px;color:#333}.setting-section[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-left:20px;color:#555}.edit-user-btn[_ngcontent-%COMP%]{background:#e3f0fd;color:#1976d2;border:none;border-radius:6px;padding:6px 18px;font-size:1em;font-weight:700;cursor:pointer;transition:background .2s,color .2s,box-shadow .2s;box-shadow:0 1px 4px #1976d214;outline:none}.edit-user-btn[_ngcontent-%COMP%]:hover{background:#1976d2;color:#fff;box-shadow:0 2px 8px #1976d22e}.button-row[_ngcontent-%COMP%]{display:flex;gap:18px;margin-top:12px}.reset-password-btn[_ngcontent-%COMP%]{background:#fff3e0;color:#f57c00;border:1px solid #ffe0b2;border-radius:6px;padding:6px 18px;font-size:1em;font-weight:700;cursor:pointer;transition:background .2s,color .2s,box-shadow .2s;box-shadow:0 1px 4px #f57c0014}.reset-password-btn[_ngcontent-%COMP%]:hover{background:#ffe0b2;color:#fff;box-shadow:0 2px 8px #f57c002e}.password-reset-form[_ngcontent-%COMP%]{background:#f5f7fa;border-radius:10px;box-shadow:0 2px 8px #1976d214;padding:20px 20px 12px;margin-top:16px;max-width:340px}.password-reset-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;color:#1976d2}.password-reset-form[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%]{border:1px solid #b0bec5;border-radius:5px;font-size:1em;margin-top:4px;margin-bottom:2px;padding:6px 8px;width:100%;background:#fff;transition:border .2s}.password-reset-form[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%]:focus{border:1.5px solid #1976d2;outline:none}.password-reset-form[_ngcontent-%COMP%]   .edit-user-btn[_ngcontent-%COMP%]{margin-top:8px}.password-reset-form[_ngcontent-%COMP%]   .edit-user-btn[_ngcontent-%COMP%]:last-child{margin-left:8px}.password-reset-form[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{color:#d32f2f;margin-bottom:8px;font-weight:700}.password-reset-form[_ngcontent-%COMP%]   .success-message[_ngcontent-%COMP%]{color:#388e3c;margin-bottom:8px;font-weight:700}.user-info[_ngcontent-%COMP%]{font-size:1.2em}.delete-account-btn[_ngcontent-%COMP%]{background:#fcdbdb;color:#d32f2f;border:1px solid #ec7575;border-radius:6px;padding:6px 18px;font-size:1em;font-weight:700;cursor:pointer;transition:background .2s,color .2s,box-shadow .2s;box-shadow:0 1px 4px #f57c0014}.delete-account-btn[_ngcontent-%COMP%]:hover{background:#d32f2f;color:#fff;border:1.5px solid #b71c1c;box-shadow:0 2px 8px #d32f2f2e}"]})};export{Z as AdminSettingComponent};
